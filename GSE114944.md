# GSE114944

[GEO](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE114944)

[Reference](https://www.nature.com/articles/s41467-018-05072-0)

## General information
Identifying tumor antigen-specific T cells from cancer patients has been a goal of tumor immunologists for several decades. Co-expression of CD103 and CD39 on CD8 TIL highly enriches for tumor-reactive T cells. **CD39+CD103+ CD8 TIL** have a distinct TCR repertoire compared to other CD8 TIL subsets and are clonally expanded within the tumor. They are highly enriched for tumor antigen recognition and efficiently killed autologous tumor cells. Patients with head and neck cancer whose CD8 TIL contained a higher frequency of CD39+CD103+ cells experienced a greater overall survival. This work describes a simple and effective method for detecting tumor-reactive CD8 TIL.

## Sample information
Peripheral blood, uninvolved LNs, metastatic LNs, and tumor samples were obtained from  individuals with head and neck small cell carcinoma (HNSCC), melanoma, colon cancer, rectal cancer, lung cancer, colorectal liver metastasis (CRLM), and ovarian cancer. PBMCs were purified. Patients had no active treatment when the samples were collected. Previous treatment include surgeries, chemotherapies, immunotherapies and radiotherapies. 15 samples in total, each defined groups consists of 5 samples.

| Cell sorting |  |
| --- | --- |
| Naive CD8+ CTL | CD8+CD4−CD45RA+CCR7+ |
| Memory CD8+ CTL | CD8+CD4−CD45RA−CCR7+/− |
| DP CD8+ TIL | CD3+CD4−CD8+CD45RA−CCR7+/−**CD39+CD103+** |
| DN CD8+ TIL | CD3+CD4−CD8+CD45RA−CCR7+/−**CD39−CD103−** |
| CD103SP CD8+ TIL | CD3+CD4−CD8+CD45RA−CCR7+/−**CD39−CD103+** |

## Code

Defined groups: DP, DN, CD103SP.

```r
library(GEOquery)
library(limma)
library(umap)

# load series and platform data from GEO
gset <- getGEO("GSE114944", GSEMatrix =TRUE, AnnotGPL=FALSE)
if (length(gset) > 1) idx <- grep("GPL15207", attr(gset, "names")) else idx <- 1
gset <- gset[[idx]]

# make proper column names to match toptable 
fvarLabels(gset) <- make.names(fvarLabels(gset))

# group membership for all samples
gsms <- "120100221020112"
sml <- strsplit(gsms, split="")[[1]]

# log2 transformation
ex <- exprs(gset)
qx <- as.numeric(quantile(ex, c(0., 0.25, 0.5, 0.75, 0.99, 1.0), na.rm=T))
LogC <- (qx[5] > 100) ||
          (qx[6]-qx[1] > 50 && qx[2] > 0)
if (LogC) { ex[which(ex <= 0)] <- NaN
  exprs(gset) <- log2(ex) }

# assign samples to groups and set up design matrix
gs <- factor(sml)
groups <- make.names(c("DP","DN","CD103SP"))
levels(gs) <- groups
gset$group <- gs
design <- model.matrix(~group + 0, gset)
colnames(design) <- levels(gs)

fit <- lmFit(gset, design)  # fit linear model

# set up contrasts of interest and recalculate model coefficients
cts <- paste(groups, c(tail(groups, -1), head(groups, 1)), sep="-")
cont.matrix <- makeContrasts(contrasts=cts, levels=design)
fit2 <- contrasts.fit(fit, cont.matrix)

# compute statistics and table of top significant genes
fit2 <- eBayes(fit2, 0.01)
tT <- topTable(fit2, adjust="fdr", sort.by="B", number=250)

tT <- subset(tT, select=c("ID","adj.P.Val","P.Value","F","GB_ACC","GI","Gene.Symbol","SPOT_ID"))
write.table(tT, file=stdout(), row.names=F, sep="\t")

# Visualize and quality control test results.
# Build histogram of P-values for all genes. Normal test
# assumption is that most genes are not differentially expressed.
tT2 <- topTable(fit2, adjust="fdr", sort.by="B", number=Inf)
hist(tT2$adj.P.Val, col = "grey", border = "white", xlab = "P-adj",
  ylab = "Number of genes", main = "P-adj value distribution")

# summarize test results as "up", "down" or "not expressed"
dT <- decideTests(fit2, adjust.method="fdr", p.value=0.05)

# Venn diagram of results
vennDiagram(dT, circle.col=palette())

# create Q-Q plot for t-statistic
t.good <- which(!is.na(fit2$F)) # filter out bad probes
qqt(fit2$t[t.good], fit2$df.total[t.good], main="Moderated t statistic")

# volcano plot (log P-value vs log fold change)
colnames(fit2) # list contrast names
ct <- 1        # choose contrast of interest
volcanoplot(fit2, coef=ct, main=colnames(fit2)[ct], pch=20,
  highlight=length(which(dT[,ct]!=0)), names=rep('+', nrow(fit2)))

# MD plot (log fold change vs mean log expression)
# highlight statistically significant (p-adj < 0.05) probes
plotMD(fit2, column=ct, status=dT[,ct], legend=F, pch=20, cex=1)
abline(h=0)

# General expression data analysis
ex <- exprs(gset)

# box-and-whisker plot
ord <- order(gs)  # order samples by group
palette(c("#1B9E77", "#7570B3", "#E7298A", "#E6AB02", "#D95F02",
          "#66A61E", "#A6761D", "#B32424", "#B324B3", "#666666"))
par(mar=c(7,4,2,1))
title <- paste ("GSE114944", "/", annotation(gset), sep ="")
boxplot(ex[,ord], boxwex=0.6, notch=T, main=title, outline=FALSE, las=2, col=gs[ord])
legend("topleft", groups, fill=palette(), bty="n")

# expression value distribution
par(mar=c(4,4,2,1))
title <- paste ("GSE114944", "/", annotation(gset), " value distribution", sep ="")
plotDensities(ex, group=gs, main=title, legend ="topright")

# UMAP plot (dimensionality reduction)
ex <- na.omit(ex) # eliminate rows with NAs
ex <- ex[!duplicated(ex), ]  # remove duplicates
ump <- umap(t(ex), n_neighbors = 7, random_state = 123)
par(mar=c(3,3,2,6), xpd=TRUE)
plot(ump$layout, main="UMAP plot, nbrs=7", xlab="", ylab="", col=gs, pch=20, cex=1.5)
legend("topright", inset=c(-0.15,0), legend=levels(gs), pch=20,
col=1:nlevels(gs), title="Group", pt.cex=1.5)
library("maptools")  # point labels without overlaps
pointLabel(ump$layout, labels = rownames(ump$layout), method="SANN", cex=0.6)

# mean-variance trend, helps to see if precision weights are needed
plotSA(fit2, main="Mean variance trend, GSE114944")
```

## Results

### Vocano plots
*Double positive vs. double negative*
![alt text](https://github.com/liuchen37/Pics/blob/main/114944_DPvsDN.jpg)


